<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>table/tablequery.js - Documentation</title>
    <meta name="viewport" content="initial-scale=.75">
    <script src="../../scripts/prettify/prettify.js"></script>
    <script src="../../scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="../../styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="../../styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><span><a href="../../index.html">Home</a> <span class="github-short">| <a href="https://github.com/azure/azure-sdk-for-node.git">GitHub</a></span></span></h2><h3>Classes</h3><ul><li><a href="BatchServiceClient.html">BatchServiceClient</a><ul class='methods'><li data-type='method'><a href="BatchServiceClient.html#addOperation">addOperation</a></li><li data-type='method'><a href="BatchServiceClient.html#beginBatch">beginBatch</a></li><li data-type='method'><a href="BatchServiceClient.html#commitBatch">commitBatch</a></li><li data-type='method'><a href="BatchServiceClient.html#hasOperations">hasOperations</a></li><li data-type='method'><a href="BatchServiceClient.html#isInBatch">isInBatch</a></li><li data-type='method'><a href="BatchServiceClient.html#processOperation">processOperation</a></li><li data-type='method'><a href="BatchServiceClient.html#processResponse">processResponse</a></li><li data-type='method'><a href="BatchServiceClient.html#rollback">rollback</a></li></ul></li><li><a href="BlobService.html">BlobService</a><ul class='methods'><li data-type='method'><a href="BlobService.html#_createBlobFromChunkStream">_createBlobFromChunkStream</a></li><li data-type='method'><a href="BlobService.html#abortCopyBlob">abortCopyBlob</a></li><li data-type='method'><a href="BlobService.html#acquireLease">acquireLease</a></li><li data-type='method'><a href="BlobService.html#breakLease">breakLease</a></li><li data-type='method'><a href="BlobService.html#clearBlobPages">clearBlobPages</a></li><li data-type='method'><a href="BlobService.html#commitBlobBlocks">commitBlobBlocks</a></li><li data-type='method'><a href="BlobService.html#copyBlob">copyBlob</a></li><li data-type='method'><a href="BlobService.html#createBlob">createBlob</a></li><li data-type='method'><a href="BlobService.html#createBlobBlockFromStream">createBlobBlockFromStream</a></li><li data-type='method'><a href="BlobService.html#createBlobBlockFromText">createBlobBlockFromText</a></li><li data-type='method'><a href="BlobService.html#createBlobPagesFromStream">createBlobPagesFromStream</a></li><li data-type='method'><a href="BlobService.html#createBlobPagesFromText">createBlobPagesFromText</a></li><li data-type='method'><a href="BlobService.html#createBlobSnapshot">createBlobSnapshot</a></li><li data-type='method'><a href="BlobService.html#createBlockBlobFromFile">createBlockBlobFromFile</a></li><li data-type='method'><a href="BlobService.html#createBlockBlobFromStream">createBlockBlobFromStream</a></li><li data-type='method'><a href="BlobService.html#createBlockBlobFromText">createBlockBlobFromText</a></li><li data-type='method'><a href="BlobService.html#createContainer">createContainer</a></li><li data-type='method'><a href="BlobService.html#createContainerIfNotExists">createContainerIfNotExists</a></li><li data-type='method'><a href="BlobService.html#createPageBlob">createPageBlob</a></li><li data-type='method'><a href="BlobService.html#createPageBlobFromFile">createPageBlobFromFile</a></li><li data-type='method'><a href="BlobService.html#createPageBlobFromStream">createPageBlobFromStream</a></li><li data-type='method'><a href="BlobService.html#deleteBlob">deleteBlob</a></li><li data-type='method'><a href="BlobService.html#deleteContainer">deleteContainer</a></li><li data-type='method'><a href="BlobService.html#generateBlockIdPrefix">generateBlockIdPrefix</a></li><li data-type='method'><a href="BlobService.html#generateSharedAccessSignature">generateSharedAccessSignature</a></li><li data-type='method'><a href="BlobService.html#getBlob">getBlob</a></li><li data-type='method'><a href="BlobService.html#getBlobMetadata">getBlobMetadata</a></li><li data-type='method'><a href="BlobService.html#getBlobProperties">getBlobProperties</a></li><li data-type='method'><a href="BlobService.html#getBlobToFile">getBlobToFile</a></li><li data-type='method'><a href="BlobService.html#getBlobToStream">getBlobToStream</a></li><li data-type='method'><a href="BlobService.html#getBlobToText">getBlobToText</a></li><li data-type='method'><a href="BlobService.html#getBlobUrl">getBlobUrl</a></li><li data-type='method'><a href="BlobService.html#getBlockId">getBlockId</a></li><li data-type='method'><a href="BlobService.html#getContainerAcl">getContainerAcl</a></li><li data-type='method'><a href="BlobService.html#getContainerMetadata">getContainerMetadata</a></li><li data-type='method'><a href="BlobService.html#getContainerProperties">getContainerProperties</a></li><li data-type='method'><a href="BlobService.html#getServiceProperties">getServiceProperties</a></li><li data-type='method'><a href="BlobService.html#listBlobBlocks">listBlobBlocks</a></li><li data-type='method'><a href="BlobService.html#listBlobRegions">listBlobRegions</a></li><li data-type='method'><a href="BlobService.html#listBlobs">listBlobs</a></li><li data-type='method'><a href="BlobService.html#listContainers">listContainers</a></li><li data-type='method'><a href="BlobService.html#putBlockBlobFromFile">putBlockBlobFromFile</a></li><li data-type='method'><a href="BlobService.html#putBlockBlobFromStream">putBlockBlobFromStream</a></li><li data-type='method'><a href="BlobService.html#releaseLease">releaseLease</a></li><li data-type='method'><a href="BlobService.html#renewLease">renewLease</a></li><li data-type='method'><a href="BlobService.html#setBlobMetadata">setBlobMetadata</a></li><li data-type='method'><a href="BlobService.html#setBlobProperties">setBlobProperties</a></li><li data-type='method'><a href="BlobService.html#setContainerAcl">setContainerAcl</a></li><li data-type='method'><a href="BlobService.html#setContainerMetadata">setContainerMetadata</a></li><li data-type='method'><a href="BlobService.html#setServiceProperties">setServiceProperties</a></li><li data-type='method'><a href="BlobService.html#statusOfCopyBlob">statusOfCopyBlob</a></li></ul></li><li><a href="QueueService.html">QueueService</a><ul class='methods'><li data-type='method'><a href="QueueService.html#clearMessages">clearMessages</a></li><li data-type='method'><a href="QueueService.html#createMessage">createMessage</a></li><li data-type='method'><a href="QueueService.html#createQueue">createQueue</a></li><li data-type='method'><a href="QueueService.html#createQueueIfNotExists">createQueueIfNotExists</a></li><li data-type='method'><a href="QueueService.html#deleteMessage">deleteMessage</a></li><li data-type='method'><a href="QueueService.html#deleteQueue">deleteQueue</a></li><li data-type='method'><a href="QueueService.html#getMessages">getMessages</a></li><li data-type='method'><a href="QueueService.html#getQueueMetadata">getQueueMetadata</a></li><li data-type='method'><a href="QueueService.html#getServiceProperties">getServiceProperties</a></li><li data-type='method'><a href="QueueService.html#listQueues">listQueues</a></li><li data-type='method'><a href="QueueService.html#peekMessages">peekMessages</a></li><li data-type='method'><a href="QueueService.html#setQueueMetadata">setQueueMetadata</a></li><li data-type='method'><a href="QueueService.html#setServiceProperties">setServiceProperties</a></li><li data-type='method'><a href="QueueService.html#updateMessage">updateMessage</a></li></ul></li><li><a href="SharedAccessSignature.html">SharedAccessSignature</a><ul class='methods'><li data-type='method'><a href="SharedAccessSignature.html#_generateSignature">_generateSignature</a></li><li data-type='method'><a href="SharedAccessSignature.html#_permissionMatchesRequest">_permissionMatchesRequest</a></li><li data-type='method'><a href="SharedAccessSignature.html#generateSignedQueryString">generateSignedQueryString</a></li><li data-type='method'><a href="SharedAccessSignature.html#signRequest">signRequest</a></li></ul></li><li><a href="SharedKey.html">SharedKey</a><ul class='methods'><li data-type='method'><a href="SharedKey.html#signRequest">signRequest</a></li></ul></li><li><a href="SharedKeyLite.html">SharedKeyLite</a><ul class='methods'><li data-type='method'><a href="SharedKeyLite.html#signRequest">signRequest</a></li></ul></li><li><a href="SharedKeyLiteTable.html">SharedKeyLiteTable</a><ul class='methods'><li data-type='method'><a href="SharedKeyLiteTable.html#signRequest">signRequest</a></li></ul></li><li><a href="SharedKeyTable.html">SharedKeyTable</a><ul class='methods'><li data-type='method'><a href="SharedKeyTable.html#signRequest">signRequest</a></li></ul></li><li><a href="TableQuery.html">TableQuery</a><ul class='methods'><li data-type='method'><a href="TableQuery.html#.select">select</a></li><li data-type='method'><a href="TableQuery.html#_replaceOperators">_replaceOperators</a></li><li data-type='method'><a href="TableQuery.html#and">and</a></li><li data-type='method'><a href="TableQuery.html#from">from</a></li><li data-type='method'><a href="TableQuery.html#or">or</a></li><li data-type='method'><a href="TableQuery.html#top">top</a></li><li data-type='method'><a href="TableQuery.html#toPath">toPath</a></li><li data-type='method'><a href="TableQuery.html#toQueryObject">toQueryObject</a></li><li data-type='method'><a href="TableQuery.html#where">where</a></li><li data-type='method'><a href="TableQuery.html#whereKeys">whereKeys</a></li><li data-type='method'><a href="TableQuery.html#whereNextKeys">whereNextKeys</a></li></ul></li><li><a href="TableService.html">TableService</a><ul class='methods'><li data-type='method'><a href="TableService.html#createTable">createTable</a></li><li data-type='method'><a href="TableService.html#createTableIfNotExists">createTableIfNotExists</a></li><li data-type='method'><a href="TableService.html#deleteEntity">deleteEntity</a></li><li data-type='method'><a href="TableService.html#deleteTable">deleteTable</a></li><li data-type='method'><a href="TableService.html#getServiceProperties">getServiceProperties</a></li><li data-type='method'><a href="TableService.html#getTable">getTable</a></li><li data-type='method'><a href="TableService.html#insertEntity">insertEntity</a></li><li data-type='method'><a href="TableService.html#insertOrMergeEntity">insertOrMergeEntity</a></li><li data-type='method'><a href="TableService.html#insertOrReplaceEntity">insertOrReplaceEntity</a></li><li data-type='method'><a href="TableService.html#mergeEntity">mergeEntity</a></li><li data-type='method'><a href="TableService.html#queryEntities">queryEntities</a></li><li data-type='method'><a href="TableService.html#queryEntity">queryEntity</a></li><li data-type='method'><a href="TableService.html#queryTables">queryTables</a></li><li data-type='method'><a href="TableService.html#setServiceProperties">setServiceProperties</a></li><li data-type='method'><a href="TableService.html#updateEntity">updateEntity</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#BatchOperation">BatchOperation</a></li><li><a href="global.html#BlobBlockRangeStream">BlobBlockRangeStream</a></li><li><a href="global.html#BlobPageRangeStream">BlobPageRangeStream</a></li><li><a href="global.html#ChunkAllocator">ChunkAllocator</a></li><li><a href="global.html#ChunkStream">ChunkStream</a></li><li><a href="global.html#ChunkStreamWithStream">ChunkStreamWithStream</a></li><li><a href="global.html#CommonOperation">CommonOperation</a></li><li><a href="global.html#createBlobService">createBlobService</a></li><li><a href="global.html#createQueueService">createQueueService</a></li><li><a href="global.html#createTableService">createTableService</a></li><li><a href="global.html#FileReadStream">FileReadStream</a></li><li><a href="global.html#ListBlobsResultContinuation">ListBlobsResultContinuation</a></li><li><a href="global.html#ListContainersResultContinuation">ListContainersResultContinuation</a></li><li><a href="global.html#ListQueuesResultContinuation">ListQueuesResultContinuation</a></li><li><a href="global.html#OperationState">OperationState</a></li><li><a href="global.html#QueryTablesResultContinuation">QueryTablesResultContinuation</a></li><li><a href="global.html#RestOperation">RestOperation</a></li><li><a href="global.html#SpeedSummary">SpeedSummary</a></li><li><a href="global.html#toHumanReadableSize">toHumanReadableSize</a></li></ul>
</nav>

<div id="main">
    
      <a class="github-banner" href="https://github.com/azure/azure-sdk-for-node.git"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
    
    
    <h1 class="page-title">table/tablequery.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>﻿// 
// Copyright (c) Microsoft and contributors.  All rights reserved.
// 
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//   http://www.apache.org/licenses/LICENSE-2.0
// 
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// 
// See the License for the specific language governing permissions and
// limitations under the License.
// 

// Module dependencies.
var _ = require('underscore');

var azureCommon = require('azure-common');
var azureutil = azureCommon.util;
var edmType = azureCommon.edmType;
var Constants = azureCommon.Constants;
var QueryStringConstants = Constants.QueryStringConstants;

/**
 * Creates a new TableQuery object.
 *
 * @constructor
 */
function TableQuery() {
  this._fields = null;
  this._from = '';
  this._where = [];
  this._top = null;
  this._partitionKey = null;
  this._nextPartitionKey = null;
  this._rowKey = null;
  this._nextRowKey = null;
}

/**
* Constructs a TableQuery specifying the select clause.
*
* @param {array} fields The fields to be selected.
* @return {TableQuery} A table query object with the select clause.
*/
TableQuery.select = function () {
  var tableQuery = new TableQuery();

  if (arguments) {
    tableQuery._fields = [];
    _.each(arguments, function (argument) {
      tableQuery._fields.push(argument);
    });
  }

  return tableQuery;
};

/**
 * Specifies the from clause.
 *
 * @param {string} name The table from where to select the entitites from.
 * @return {TableQuery} A table query object with the from clause.
 */
TableQuery.prototype.from = function (name) {
  this._from = name;
  return this;
};

/**
 * Specifies the partition and row keys.
 *
 * @param {string} partitionKey The partition key for the entities to query.
 * @param {string} rowKey       The row key for the entities to query.
 * @return {TableQuery} A table query object with the where clause.
 */
TableQuery.prototype.whereKeys = function (partitionKey, rowKey) {
  this._partitionKey = partitionKey;
  this._rowKey = rowKey;
  return this;
};

/**
 * Specifies the next keys.
 *
 * @param {string} nextPartitionKey The next partition key for the entities to start querying from.
 * @param {string} nextRowKey       The next row key for the entities to start querying from.
 * @return {TableQuery} A table query object with the where clause.
 */
TableQuery.prototype.whereNextKeys = function (nextPartitionKey, nextRowKey) {
  this._nextPartitionKey = nextPartitionKey;
  this._nextRowKey = nextRowKey;
  return this;
};

/**
 * Specifies the where clause.
 *
 * @param {string}       condition   The condition string.
 * @param {string|array} value       Value(s) to insert in question mark (?) parameters.
 * @return {TableQuery} A table query object with the where clause.
 */
TableQuery.prototype.where = function (condition) {
  condition = this._replaceOperators(condition);
  if (arguments.length > 1) {
    var quotedArguments = [arguments[0]];
    for (var i = 1; i &lt; arguments.length; i++) {
      quotedArguments.push(edmType.serializeQueryValue(arguments[i]));
    }

    condition = azureutil.stringFormat.apply(this, quotedArguments);
  }

  this._where.push(condition);
  return this;
};

/**
 * Specifies an AND where condition.
 *
 * @param {string}       condition   The condition string.
 * @param {array}        arguments   Any number of arguments to be replaced in the condition by the question mark (?).
 * @return {TableQuery} A table query object with the and clause.
 */
TableQuery.prototype.and = function (condition) {
  if (this._where.length === 0) {
    throw new Error('And operator needs to be used after where');
  }

  condition = this._replaceOperators(condition);
  if (arguments.length > 1) {
    var quotedArguments = [arguments[0]];
    for (var i = 1; i &lt; arguments.length; i++) {
      quotedArguments.push(edmType.serializeQueryValue(arguments[i]));
    }

    condition = azureutil.stringFormat.apply(this, quotedArguments);
  }

  this._where.push(' and ' + condition);
  return this;
};

/**
 * Specifies an OR where condition.
 *
 * @param {string}       condition   The condition.
 * @param {array}        arguments   Any number of arguments to be replaced in the condition by the question mark (?).
 * @return {TableQuery} A table query object with the or clause.
 */
TableQuery.prototype.or = function (condition) {
  if (this._where.length === 0) {
    throw new Error('Or operator needs to be used after where');
  }

  condition = this._replaceOperators(condition);
  if (arguments.length > 1) {
    var quotedArguments = [arguments[0]];
    for (var i = 1; i &lt; arguments.length; i++) {
      quotedArguments.push(edmType.serializeQueryValue(arguments[i]));
    }

    condition = azureutil.stringFormat.apply(this, quotedArguments);
  }

  var binaryOperation = ' or ';

  this._where.push(binaryOperation + condition);
  return this;
};

/**
 * Specifies the top clause.
 *
 * @param {int} top The number of items to fetch.
 * @return {TableQuery} A table query object with the top clause.
 */
TableQuery.prototype.top = function (top) {
  this._top = top;
  return this;
};

/**
 * Returns the query string object for the query.
 *
 * @return {object} JSON object representing the query string arguments for the query.
 */
TableQuery.prototype.toQueryObject = function () {
  var query = {};
  if (this._fields &amp;&amp; this._fields.length > 0) {
    for (var field in this._fields) {
      if (this._fields.hasOwnProperty(field)) {
        this._fields[field] = this._fields[field];
      }
    }

    query[QueryStringConstants.SELECT] = this._fields.join(',');
  }

  if (this._where.length > 0 ||
     (this._partitionKey &amp;&amp; !this._rowKey)) {

    var filter = this._where.join('');
    if (this._partitionKey &amp;&amp; !this._rowKey) {
      if (this._where.length > 0) {
        filter += ' and ';
      }

      filter += 'PartitionKey eq \'' + this._partitionKey + '\'';
    }

    query[QueryStringConstants.FILTER] = filter;
  }

  if (this._top) {
    query[QueryStringConstants.TOP] = this._top;
  }

  if (this._nextPartitionKey) {
    query[QueryStringConstants.NEXT_PARTITION_KEY] = this._nextPartitionKey;
  }

  if (this._nextRowKey) {
    query[QueryStringConstants.NEXT_ROW_KEY] = this._nextRowKey;
  }

  return query;
};

/**
* Returns the URL path.
*
* @return {string} The path string.
*/
TableQuery.prototype.toPath = function () {
  var path = '';

  if (this._partitionKey &amp;&amp; this._rowKey) {
    path += 'PartitionKey=\'' + this._partitionKey + '\'';
    path += ', RowKey=\'' + this._rowKey + '\'';
  }

  return (this._from + '(' + path + ')');
};

// Functions

/**
 * Replace operators.
 *
 * @param {string} whereClause The text where to replace the operators.
 * @return {string} The string with the replaced operators.
 */
TableQuery.prototype._replaceOperators = function (whereClause) {
  whereClause = whereClause.replace(/ == /g, ' eq ');
  whereClause = whereClause.replace(/ != /g, ' ne ');
  whereClause = whereClause.replace(/ >= /g, ' ge ');
  whereClause = whereClause.replace(/ > /g, ' gt ');
  whereClause = whereClause.replace(/ &lt;= /g, ' le ');
  whereClause = whereClause.replace(/ &lt; /g, ' lt ');
  whereClause = whereClause.replace(/ \&amp;\&amp; /g, ' and ');
  whereClause = whereClause.replace(/ \|\| /g, ' or ');
  whereClause = whereClause.replace(/!/g, 'not');

  return whereClause;
};

module.exports = TableQuery;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jul 19 2016 18:58:53 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="../../scripts/linenumber.js"></script>
</body>
</html>
